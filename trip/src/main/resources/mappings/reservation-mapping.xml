<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ReservationDAO">

	<!-- 숙소 예약 등록 -->
	<insert id="insertReservation">
		INSERT INTO RESERVATION (RES_ID, USER_ID, HOST_ID, ROOM_ID, ROOM_NAME, ROOM_IMG, PAY_DATE, PAY_AMOUNT, RES_NUM, 
		RES_COUNT, RES_STATUS, RES_CHECKIN, RES_CHECKOUT)
		VALUES(#{res_id}, #{user_id}, #{host_id}, #{room_id}, #{room_name}, #{room_img}, #{pay_date}, #{pay_amount}, #{res_num},
		#{res_cancel}, #{res_status}, #{res_checkin}, #{res_checkout})
	</insert>
	
	<!-- 숙소 예약 수정 (기본적으로 예약 번호와 유저 아이디와 예약 상태가 취소 가능하다는 상태 아래 일정 조정 즉, 
	체크인/체크아웃 날짜 조정 (처음 예약했던 기간만 가능, 거기서 날짜 변경만 가능 ex) 21~24일 예약 3일 예약 여기서 3일 기준으로 날짜만 변경 가능하게 함) -->
	<!-- 업데이트 쿼리문 돌려서 예약 변경할때마다 자동적으로 RES_COUNT 컬럼에 들어가는 값이 기존에 있던 값보다 하나씩 줄 예정 
	(초기값 3 => 2 => 1 => 0 => 0되면 더이상 수정이 불가능하도록 조치 예정 -->
	
	<!-- 예약 변경 가능 상태 => 1 == 예약 변경 가능, 2 == 예약 변경 불가, 3 == 예약 취소 완료, 4 == 사용 완료 (리뷰 작성 가능) -->
	<update id="updateReservation">
		UPDATE RESERVATION
		SET RES_CHECKIN = #{res_checkin}, RES_CHECKOUT = #{res_checkout}, RES_COUNT=#{res_count}-1, RES_STATUS = #{res_status} 
		WHERE RES_ID = #{res_id} AND USER_ID = #{user_id} AND RES_STATUS = '1'
	</update>
	
	<!-- 숙소 예약 삭제 => 처음 계획했던 일정에서 더 추가 일자로 숙박하거나 더 적게 숙박해야할때 먼저 취소 후 새로 다시 등록 (예약) -->
	<delete id="deleteReservation">
		DELETE FROM RESERVATION WHERE
		RES_ID = #{res_id} AND USER_ID = #{user_id}
	</delete>
	
	<!-- 숙소 예약 조회  -->
	<select id="getReservationList" resultType="reservation">
		SELECT * FROM RESERVATION WHERE USER_ID = #{user_id}
	</select>
	
	<!-- 숙소 총 예약 갯수 조회 -->
	<select id="getReservationListCnt" resultType="_int">
		SELECT COUNT(*) FROM RESERVATION WHERE USER_ID = #{user_id}
	</select>
	

</mapper>
